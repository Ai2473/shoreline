package net.shoreline.client.impl.module.exploit;

import net.minecraft.network.packet.c2s.play.UpdateSignC2SPacket;
import net.shoreline.client.api.config.Config;
import net.shoreline.client.api.config.setting.EnumConfig;
import net.shoreline.client.api.event.listener.EventListener;
import net.shoreline.client.api.module.ModuleCategory;
import net.shoreline.client.api.module.ToggleModule;
import net.shoreline.client.impl.event.network.PacketEvent;
import net.shoreline.client.init.Managers;

/**
 * @author linus
 * @since 1.0
 */
public class ColorSignsModule extends ToggleModule {
    //
    Config<SignMode> modeConfig = new EnumConfig<>("Mode", "The mode for replacing colors in signs", SignMode.VANILLA, SignMode.values());

    /**
     *
     */
    public ColorSignsModule() {
        super("ColorSigns", "Allow colors in signs (Use & before color codes)",
                ModuleCategory.EXPLOITS);
    }

    @EventListener
    public void onPacketOutbound(PacketEvent.Outbound event) {
        if (event.getPacket() instanceof UpdateSignC2SPacket packet && !event.isClientPacket()) {
            String[] signText = packet.getText();
            for (int i = 0; i < signText.length; i++) {
                signText[i] = signText[i].replace("&", switch (modeConfig.getValue()) {
                    case VANILLA -> "§§0";
                    case NORMAL -> "§§§00";
                    case REPLACE -> "§§$1$1";
                });
            }
            event.cancel();
            Managers.NETWORK.sendPacket(new UpdateSignC2SPacket(packet.getPos(), true,
                    signText[0], signText[1], signText[2], signText[3]));
        }
    }

    public enum SignMode {
        VANILLA,
        NORMAL,
        REPLACE
    }
}
